<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="duogram">

	<insert id="insertAccept" parameterType="Integer">
		INSERT INTO duogram (memberNum) VALUES (#{memberNum})
	</insert>
	
	<insert id="insertBoard" parameterType="com.duospace.duogram.Duogram">
		INSERT INTO gramTimeLine (num, memberNum, content,blogNum,
			saveFilename, originalFilename)
			VALUES (seq_gramtimeline.NEXTVAL, #{memberNum}, #{content}, #{blogNum}
			, #{saveFilename, jdbcType=VARCHAR}, #{originalFilename, jdbcType=VARCHAR})
	</insert>
	
	<select id="countAccept" parameterType="Integer" resultType="Integer">
	   SELECT COUNT(*) FROM duogram WHERE memberNum = #{memberNum}
	</select>
	
	<select id="dataCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(*), 0)
		FROM gramtimeline g
		JOIN member2 m2 ON g.memberNum=m2.memberNum
		WHERE g.blogNum=#{blogNum}
	</select>
	
	<select id="listBoard" parameterType="map"
				resultType="com.duospace.duogram.Duogram">
		SELECT * FROM(
			SELECT ROWNUM rnum, tb. * FROM (
				SELECT num, m2.name, g.memberNum, blogNum, content, created
				FROM gramtimeline g
				JOIN member2 m2 ON g.memberNum=m2.memberNum
				WHERE g.blogNum=#{blogNum}
				ORDER BY num DESC
		<![CDATA[
			) tb WHERE ROWNUM <= #{end}
		) WHERE rnum >= #{start}
			]]>
	</select>
	
	<!-- 삭제 -->
	<delete id="deleteGram" parameterType="Integer">
            DELETE FROM gramtimeline WHERE num = #{num}
      </delete>
	
	<!-- 댓글 -->
	<insert id="gramReply" parameterType="com.duospace.duogram.Reply">
      		INSERT INTO gramReply(replyNum, num, content, answer)
      			VALUES(gramReply_seq.NEXTVAL, #{num}, #{content}, #{answer})   
    </insert>
	
</mapper>