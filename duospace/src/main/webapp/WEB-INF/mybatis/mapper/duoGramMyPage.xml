<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">

	<insert id="mypageInsertAccept" parameterType="Integer">
		INSERT INTO duogram (memberNum) VALUES (#{memberNum})
	</insert>
	
	<!-- 글쓰기 -->
	<insert id="mypageInsertBoard" parameterType="com.duospace.duogram.mypage.Mypage">
		INSERT INTO gramTimeLine (num, memberNum, content, blogNum,
			saveFilename, originalFilename)
			VALUES (seq_gramtimeline.NEXTVAL, #{memberNum}, #{content}, #{blogNum}
			, #{saveFilename, jdbcType=VARCHAR}, #{originalFilename, jdbcType=VARCHAR})
	</insert>
	
	<select id="mypageCountAccept" parameterType="Integer" resultType="Integer">
	   SELECT COUNT(*) FROM duogram WHERE memberNum = #{memberNum}
	</select>
	
	<select id="mypageDataCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(*), 0)
		FROM gramtimeline g
		JOIN member2 m2 ON g.memberNum=m2.memberNum
		WHERE g.blogNum=#{blogNum}
	</select>
	
	<!-- 글 수정 -->
    <update id="updateBoard" parameterType="com.duospace.duogram.mypage.Mypage">
         UPDATE gramTimeLine SET content=#{content} WHERE num = #{num}
    </update>
      
	<!-- 리스트 -->
	<select id="mypageListBoard" parameterType="map"
				resultType="com.duospace.duogram.mypage.Mypage">
		SELECT * FROM(
			SELECT ROWNUM rnum, tb. * FROM (
				SELECT num, m2.name, g.memberNum, blogNum, content, created
				FROM gramtimeline g
				JOIN member2 m2 ON g.memberNum=m2.memberNum
				WHERE g.blogNum=#{blogNum}
				ORDER BY num DESC
		<![CDATA[
			) tb WHERE ROWNUM <= #{end}
		) WHERE rnum >= #{start}
			]]>
	</select>
	
	<!-- 삭제 -->
	<delete id="deleteMypage" parameterType="Integer">
            DELETE FROM gramtimeline WHERE num = #{num}
    </delete>
      
    <!-- 글보기 -->
	<select id="readBoard" resultType="com.duospace.duogram.mypage.Mypage" parameterType="Integer">
		SELECT num, m2.name, g.memberNum, blogNum, content, created
		FROM gramtimeline g 
		JOIN member2 m2 ON g.memberNum=m2.memberNum
		WHERE num = #{num}
	</select>
	
    <!-- 댓글 -->
    <insert id="insertReply" parameterType="com.duospace.duogram.mypage.Mypage">
    	INSERT INTO gramreply(replyNum, num, content, answer)
     	VALUES(bbsReply_seq.NEXTVAL, #{num}, #{content}, #{answer})   
    </insert>
</mapper>